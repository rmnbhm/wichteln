<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<div th:replace="fragments/head :: head"></div>

<body>
<div th:replace="fragments/header :: header"></div>

<div class="container-sm">
    <form id="event-creation-form"
          class="form-horizontal"
          th:object="${event}"
          th:action="@{/preview}"
          method="post">
        <div id="event-creation-form-inputs-holder"
             th:hidden="true"
             th:insert="fragments/form :: event-creation-form-inputs">
        </div>
        <div id="preview">
            <button type="button" id="back-button" class="btn btn-secondary my-3 mr-3" onclick="history.back()">Back
            </button>
            <button type="submit" id="submit-button" class="btn btn-primary my-3">Submit</button>
            <p th:text="'FROM: ' + ${preview.from}"></p>
            <p th:text="'TO: ' + ${preview.to[0]}"></p>
            <p th:text="'SUBJECT: ' + ${preview.subject}"></p>
            <p>TEXT:</p>
            <blockquote style="background: #eee;border-radius: 5px; padding: 15px;"
                        th:utext="${#strings.replace(preview.text, T(org.apache.commons.lang3.StringUtils).LF, '&lt;br /&gt;')}">
            </blockquote>
        </div>
    </form>
</div> <!-- /container -->
<script th:inline="javascript">
    function needsFallback() {
        // Test whether a new datetime-local input falls back to a text input or not
        const test = document.createElement('input');

        try {
            test.type = 'datetime-local';
        } catch (e) {
            console.log(e.description);
        }
        return test.type === 'text';
    }

    if (needsFallback()) {
        const dateTimeInput = document.getElementById('local-date-time');
        dateTimeInput.type = 'date';
        document.getElementById('submit-button').onclick = function () {
            // Temporarily fall even further back to 'text' type so we may manipulate the value since an input element
            // of type 'date' would not allow a value like "2020-11-01T00:00".
            dateTimeInput.type = 'text';
            dateTimeInput.value = dateTimeInput.value + "T00:00";
        };
    }

</script>
</body>
</html>